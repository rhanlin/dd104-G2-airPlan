 //  ================Vue  這是商城區======================================================
 new Vue({
   el: '#app',
   data: {
     visibility: 'countries',
     items: [{
         style: 'letter',
         id: 'itemCard1',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard2',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard3',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard4',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard5',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard6',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard7',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard8',
         url: '',
         class: ""
       },
       {
         style: 'tool',
         id: 'itemCard9',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard10',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard11',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard12',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard13',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard14',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard15',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard16',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard17',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard18',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard19',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard20',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard21',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard22',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard23',
         url: '',
         class: ""
       },
       {
         style: 'countries',
         id: 'itemCard24',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard25',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard26',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard27',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard28',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard29',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard30',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard31',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard32',
         url: '',
         class: ""
       },
       {
         style: 'frame',
         id: 'itemCard33',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard34',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard35',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard36',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard37',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard38',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard39',
         url: '',
         class: ""
       },
       {
         style: 'simple',
         id: 'itemCard40',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard41',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard42',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard43',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard44',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard45',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard46',
         url: '',
         class: ""
       },
       {
         style: 'animal',
         id: 'itemCard47',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard48',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard49',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard50',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard51',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard52',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard53',
         url: '',
         class: ""
       },
       {
         style: 'handpattern',
         id: 'itemCard54',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard55',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard56',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard57',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard58',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard59',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard60',
         url: '',
         class: ""
       },
       {
         style: 'vector',
         id: 'itemCard61',
         url: '',
         class: ""
       },
     ],
     page: 1,
     windowWidth: 0,
     theIndex: 0,
     item: {},
   },
   computed: {
     //==================filter ES6寫法============================================================
     pagedListdata: function () {
       var vm = this;
       // if (vm.visibility == 'all') {
       //   return vm.items
       // }

       return vm.items.filter(
         item => {
           return item.style == vm.visibility
         }

       );

     },
   },
   watch: {
     page() {
       this.change();
     },
     visibility() {
       var vm = this;
       if (vm.visibility == "letter") {
         console.log();
         document.getElementById('line_top').style.display = "none";
         document.getElementById('line_bottom').style.display = "none";
       }
     }
   },
   methods: {
     //==============跳窗的購買btn點按後將已購素材傳回資料庫的material表格 目前會員編號寫死======================================
     mousemove(e) {
       e.stopPropagation()
      //  console.log(e.target)
       e.target.classList.add('hoverRotate');
     },
     mouseout(e) {
       e.stopPropagation()
      //  console.log(ownMatPrice)
       e.target.classList.remove('hoverRotate');
     },
     customerOrder(e) {
       e.stopPropagation()
       // console.log(e.target);
       ownMatName = e.target.parentNode.parentNode.parentNode.parentNode.children[1].children[0].children[0]
         .innerHTML;
       ownMatPrice = e.target.parentNode.parentNode.parentNode.parentNode.children[1].children[2].children[0]
         .children[0].innerHTML;
       materialMatSort = "material";
       toolMatSort = "tool";

       var msg = `您確定要購買【 ${ownMatName} 】這項商品嗎，它須花費【 ${ownMatPrice} 】元!!\n確定要購買請按『確定』，否則請按『取消』返回。`;

       if (confirm(msg) == true) {
         cavMemberH = document.getElementById('cavMemberH').innerHTML;
         cavMemberH = cavMemberH.toString().substring(6);
         console.log(cavMemberH)
         //==============如果跳窗抓到的URL值不是soldOut才可以購買(否則是重複購買)======================================
         // ===========這是從資料庫抓已購素材中的url來對比並把卡片改成soldOut ================================================
         axios
           .get('./phps/shop_axios_post.php?get=shop_getmaterial&memNo=' + cavMemberH)
           .then((res) => {

             var matObject = res.data;
             // console.log(matObject)
             arr = [];
             for (var j = 0; j < matObject.length; j++) {
               arr.push(matObject[j].matName)
             }
             // console.log(arr)
             // console.log(arr.indexOf(ownMatName))
             if (arr.indexOf(ownMatName) != -1) {

               alert("你已經買過此商品囉");
               // break;
             } else {
               // alert("aa")
               ownMatURL = this.items[theIndex - 1].url;
               itemIndex = this.items[theIndex - 1].id.substring(8);

               cavMemberH = document.getElementById('cavMemberH').innerHTML;
               cavMemberH = cavMemberH.toString().substring(6);
               console.log(cavMemberH)
               if (9 < itemIndex) {

                 $.ajax({
                   type: "POST",
                   url: "./phps/shop_saveImg.php",
                   data: {
                     memNo: cavMemberH,
                     matName: ownMatName,
                     image: ownMatURL,
                     matLSort: materialMatSort,
                   },
                 })
               } else if (2 <= itemIndex && itemIndex < 10) {
                 $.ajax({
                   type: "POST",
                   url: "./phps/shop_saveImg.php",
                   data: {
                     memNo: cavMemberH,
                     matName: ownMatName,
                     image: ownMatURL,
                     matLSort: toolMatSort,
                   },
                 })
               } else if (itemIndex == 1) {
                 cavPaperN = document.getElementById('cavPaperN');
                 cavPaperHInner = cavPaperN.innerHTML;
                 cavPaperNum = cavPaperHInner.toString().substring(3);
                 remainLet = `${parseInt(cavPaperNum)+10}`
                 remainLetStr = `信封:${parseInt(cavPaperNum)+10}`

                 cavPaperN.innerHTML = remainLetStr;
                 console.log(remainLet)
                 $.ajax({
                   type: "POST",
                   url: "./phps/shop_saveLetter.php",
                   data: {
                     remainLet: remainLet,
                     memNo: cavMemberH,
                   },
                 });
               }

               coin = document.getElementById('coin');
               ownMatPriceNum = parseInt(ownMatPrice);
               coinInnerCount = document.getElementById('coinInnerCount');

               coinInnerCount.innerHTML = ownMatPriceNum;
               console.log(coinInnerCount)
               var xhr2 = new XMLHttpRequest();
               xhr2.onload = function () {
                 if (xhr2.status == 200) {

                   cavMemberH = document.getElementById('cavMemberH').innerHTML;
                   cavMemberH = cavMemberH.toString().substring(6);
                   // cavMemberH.innerHTML = 5;
                   let nowCoin = JSON.parse(xhr2.responseText);

                   uesrCoinNum = parseInt(nowCoin[0].airCoin);
                   if (uesrCoinNum >= ownMatPriceNum) {
                     boughtProd();
                     remainCoin = uesrCoinNum - ownMatPriceNum;
                     remainCoinInnerCount = document.getElementById('coin');
                     remainCoinInnerCount.innerHTML = remainCoin;


                     cavCoinH = document.getElementById('cavCoinN');
                     cavCoinHInner = cavCoinH.innerHTML;
                     cavCoinHNum = cavCoinHInner.toString().substring(5);
                     // cavCoinHNum = coin.innerHTML;
                     cavCoinHInner = `Air幣${remainCoin}`;
                     cavCoinH.innerHTML = cavCoinHInner;
                     // let navcoin = document.getElementById('cavCoinN').innerText;
                     // console.log('airrrcoin', navcoin);
                     // console.log("========1", coin.innerHTML)
                     // console.log("========2", cavCoinHInner)
                     // console.log("========3", cavCoinH.innerHTML)
                     // console.log(remainCoin) 


                     $.ajax({
                       type: "POST",
                       url: "./phps/shop_saveCoin.php",
                       data: {
                         remainCoin: remainCoin,
                         memNo: cavMemberH,
                       },
                     });
                   } else {

                     alert("抱歉你的剩餘air幣不足無法購買此商品!!!")
                   }
                   // location.reload();
                 } else {
                   alert(xhr2.status);
                 }

               }
               var url = "./phps/shop_axios_post.php?get=shop_getMemberCoin&memNo=" + cavMemberH;
               xhr2.open("Get", url, true);
               xhr2.send(null);
             }

           })
           .catch((error) => {
             console.log(error)
           })

       } else {
         return false;
       }

     },
     //====================資料庫data寫入跳窗內資料==========================================
     carddark() {
       cavMemberH = document.getElementById('cavMemberH').innerHTML;
       cavMemberH = cavMemberH.toString().substring(6);
       console.log(cavMemberH)
       // var vm = this;
       axios
         .get('./phps/shop_axios_post.php?get=shop_getmaterial&memNo=' + cavMemberH)
         .then((res) => {
           var itemArr = res.data;
           // console.log(this.items)
           console.log('itemArr:', itemArr)
           for (var i = 0; i < this.items.length; i++) {
             // console.log(vm.items[i].url)
             // console.log(itemArr[0].matURL);
             for (var j = 0; j < itemArr.length; j++) {
               if (this.items[i].url == itemArr[j].matURL) {
                 this.items[i].url = "./img/product/decorate/sold.png";
                 this.items[i].class = "bought"
               }
             }
           }
         })
         .catch((error) => {
           console.log(error)
         })
     },


     //  ================這是關閉跳窗用===========================================================
     closeModel() {
       this.showToolInfo();
       this.showMaterial();
       this.carddark()
       $('#outshadow').css('visibility', 'hidden');
       $('#outshadow').css('zIndex', '-99');
       $('#medal').css('display', 'none');

       // e ? e.stopPropagation() : event.cancelBubble = true;

     },

     changeIndex(e) {
       console.log(e.target.style.backgroundImage)
       var text = 'url("./img/product/decorate/sold.png")';
       text = text.toString();
       console.log(text);
       if (`${e.target.style.backgroundImage}` != text) {
         theIndex = e.target.id.substring(8);
         // console.log(theIndex);
         var xhr = new XMLHttpRequest();
         xhr.onload = function () {
           if (xhr.status == 200) {
             // showProduct();
             let product = JSON.parse(xhr.responseText);
             // console.log(product) 
             i = theIndex - 1;
             // console.log(i);
             $('#titleInner').html(product[i].matNameCH);
             $('#infoInner').html(product[i].matInfo);
            //  $('#chanceInner').html(product[i].matChance);
             $('#priceInner').html(product[i].prodPrice);
             // console.log(xhr.responseText)
           } else {
             // alert(xhr.status);
           }
         }

         var url = "./phps/shop_axios_post.php?get=shop_prodItemGetInfo";
         xhr.open("Get", url, true);
         xhr.send(null);

         $('#outshadow').css('opacity', '0.7');
         $('#outshadow').css('visibility', 'visible');
         $('#outshadow').css('zIndex', '99');
         $('#medal').css('display', 'block');
         $('#medal').css('zIndex', '100');

       } else {
         alert("你已經買過此商品囉")
       }

     },
     //====================Vue響應式========================================================
     getWindowWidth(event) {
       this.windowWidth = document.documentElement.clientWidth;
       // console.log(this.windowWidth)

     },
     //====================分頁按鈕==========================================================
     change(index) {

       if (this.windowWidth < 576) {
         if (this.page == 1) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 6) return true;
         } else if (this.page == 2) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 12 && index >= 6) return true;
         } else if (this.page == 3) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 18 && index >= 12) return true;


         }
       } else if (this.windowWidth < 767) {
         if (this.page == 1) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 8) return true;
         } else if (this.page == 2) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 17 && index >= 8) return true;
         } else if (this.page == 3) {
           document.getElementsByClassName("line_bottom")[0].style.display = "none";
           document.getElementsByClassName("line_top")[0].style.display = "none";
           if (index < 25 && index >= 17) return true;
         }
       } else if (this.page == 1) {
         if (this.visibility != "letter") {
           document.getElementsByClassName("line_top")[0].style.display = "block";
           document.getElementsByClassName("line_bottom")[0].style.display = "block";
         }

         if (index < 10) return true;
       } else if (this.page == 2) {
         document.getElementsByClassName("line_top")[0].style.display = "block";
         document.getElementsByClassName("line_bottom")[0].style.display = "none";
         if (index < 20 && index >= 10) return true;
       } else if (this.page == 3) {
         document.getElementsByClassName("line_bottom")[0].style.display = "none";
         document.getElementsByClassName("line_top")[0].style.display = "none";
         if (index < 30 && index >= 20) return true;
       }
     },

     showToolInfo() {
       cavMemberH = document.getElementById('cavMemberH').innerHTML;
       cavMemberH = cavMemberH.toString().substring(6);
       // ===================這是左邊功能頁(資料庫抓入已購買工具) =======================
       console.log(cavMemberH)
       axios
         .get('./phps/shop_axios_post.php?get=shop_getonlyTool&memNo=' + cavMemberH)
         .then((res) => {
           var toolInfo = res.data;
           console.log(toolInfo)
           arr1 = ['controlBox1', 'controlBox2', 'controlBox3', 'controlBox4', 'controlBox5', 'controlBox6',
             'controlBox7',
             'controlBox8'
           ]
           arr2 = ['controlBtn1', 'controlBtn2', 'controlBtn3', 'controlBtn4', 'controlBtn5', 'controlBtn6',
             'controlBtn7',
             'controlBtn8'
           ]
           for (i = 0; i < toolInfo.length; i++) {

             if (toolInfo[i].matURL) {

               indexStr = toolInfo[i].matURL.toString();
               index = indexStr.substring(26, indexStr.length - 4) - 1;
               console.log(index)

               for (j = 0; j < arr1.length; j++) {
                 if (index == j) {
                   document.getElementById(arr1[j]).classList.remove('clicked');
                   document.getElementsByClassName(arr2[j])[0].classList.remove('clicked');
                 }
               }
             }
           }
         })
         .catch((error) => {
           console.log(error)
         })
     },

     showMaterial() {
       cavMemberH = document.getElementById('cavMemberH').innerHTML;
       cavMemberH = cavMemberH.toString().substring(6);
       // cavMemberH.innerHTML = 5;
       console.log(cavMemberH)
       // =====================這是輪播圖片(資料庫抓入已購買素材)   =======================
       axios
         .get('./phps/shop_axios_post.php?get=shop_getOnlyMaterial&memNo=' + cavMemberH)
         .then((res) => {
           var gotMaterial = res.data;
           console.log(gotMaterial)
           console.log(gotMaterial[0])
           if (gotMaterial.length > 0) {

             for (var i = 0; i < gotMaterial.length; i++) {
               owl_item = document.getElementsByClassName('owl-item')[0].firstChild;
               console.log(owl_item.src)
               owl_imgcloned = document.getElementsByClassName('cloned')[i].firstChild;
               owl_imgactive = document.querySelectorAll('.owl-stage .active')[i].firstChild;
               if (owl_item.src == location.href) {
                 // alert("")
                 owl_item.src = gotMaterial[i].matURL
                 owl_imgcloned.src = gotMaterial[i].matURL
                 owl_imgactive.src = gotMaterial[i].matURL
                 // console.log(owl_item)
                 // console.log(owl_imgcloned)
               }
               if (owl_imgactive.src == location.href) {
                 owl_imgactive.src = gotMaterial[i].matURL
               }
               // console.log(owl_imgactive)
             }
           } else {
             // alert("無任何素材");
           }
         })
         .catch((error) => {
           console.log(error)
         })
     },

   },

   mounted() {
     var vm = this;

     window.addEventListener('load', function () {
       setTimeout(vm.checkItem, 500);
     });

     window.addEventListener('load', function () {
       setTimeout(vm.carddark, 500);
     });
     window.addEventListener('load', function () {
       setTimeout(vm.showToolInfo, 500);
     });
     window.addEventListener('load', function () {
       setTimeout(vm.showMaterial, 500);
     });


     //====================Vue響應式==========================================================================
     this.$nextTick(function () {
       window.addEventListener('resize', this.getWindowWidth);
       this.getWindowWidth()

     });

     //====================頁面onload後直接抓回64筆商城卡片資料給vue data=>items======================================
     axios
       .get('./phps/shop_axios_post.php?get=shop_axios_post')
       .then((res) => {
         var arr = res.data;
         console.log(arr)
         //====================動態新增商品數量======================================
         if (arr.length >= 62) {
           console.log(arr.length)
           var j = 0;
           for (var i = arr.length; i > 61; i--) {

             var arrIndex = 62 + j;
             var item = {
               style: 'vector',
               id: `itemCard${arrIndex}`,
               url: '',
               class: ""
             }
             this.items.push(item)
             j++;
           }
         }
         for (var i = 0; i < arr.length; i++) {
           this.items[i].url = arr[i].prodUrl
         }
         // if (arr.length != 62) {
         //   this.items[61].class = "hide"
         // }


       })
       .catch((error) => {
         console.log(error)
       });
   },


   beforeDestroy() {
     window.removeEventListener('resize', this.getWindowWidth);
   },

 })